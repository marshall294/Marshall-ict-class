<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reading Speed Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
    }

    .container {
      max-width: 600px;
      margin: 40px auto;
    }

    #text-to-read {
      font-size: 20px;
      margin-bottom: 20px;
      height: 50px;
      transition: opacity 0.5s;
    }

    #start-btn {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }

    #results {
      margin-top: 20px;
    }

    .highlight {
      background-color: yellow;
      transition: background-color 0.5s;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Reading Speed Test</h1>
    <p id="text-to-read"></p>
    <button id="start-btn">Start Reading</button>
    <div id="results"></div>
  </div>

  <script>
    const recognition = new webkitSpeechRecognition();
    recognition.lang = 'en-US';
    recognition.continuous = true;
    recognition.interimResults = true;

    const textToReadElement = document.getElementById('text-to-read');
    const textToRead = [
      "The quick brown fox jumps over the lazy dog today.",
      "The sun is shining brightly in the clear blue sky.",
      "The stars are twinkling like diamonds in the night.",
      "The world is full of wonder and magic."
    ];
    let currentTextIndex = 0;
    let startTime, endTime;
    let words = [];
    let wordIndex = 0;

    textToReadElement.textContent = textToRead[currentTextIndex];

    document.getElementById('start-btn').addEventListener('click', () => {
      recognition.start();
      startTime = new Date().getTime();
      words = textToRead[currentTextIndex].split(' ');
      wordIndex = 0;
      highlightWord();
    });

    recognition.onresult = (event) => {
      const transcription = event.results[0][0].transcript;
      const word = words[wordIndex].toLowerCase();
      const transcribedWord = transcription.split(' ').pop().toLowerCase();

      if (word === transcribedWord) {
        wordIndex++;
        highlightWord();
      }

      if (wordIndex === words.length) {
        endTime = new Date().getTime();
        const accuracy = calculateAccuracy(textToRead[currentTextIndex], transcription);
        const speed = calculateSpeed(textToRead[currentTextIndex], startTime, endTime);
        displayResults(accuracy, speed);
        currentTextIndex++;
        if (currentTextIndex < textToRead.length) {
          setTimeout(() => {
            textToReadElement.textContent = textToRead[currentTextIndex];
            words = textToRead[currentTextIndex].split(' ');
            wordIndex = 0;
            highlightWord();
          }, 2000);
        } else {
          recognition.stop();
        }
      }
    };

    recognition.onerror = (event) => {
      console.error(event);
    };

    function calculateAccuracy(original, transcription) {
      const originalWords = original.split(' ');
      const transcriptionWords = transcription.split(' ');
      let correctWords = 0;
      originalWords.forEach((word, index) => {
        if (word === transcriptionWords[index]) {
          correctWords++;
        }
      });
      return (correctWords / originalWords.length) * 100;
    }

    function calculateSpeed(text, startTime, endTime) {
      const words = text.split(' ');
      const timeTaken = (endTime - startTime) / 1000; // seconds
      return Math.round((words.length / timeTaken) * 60); // words per minute
    }

    function displayResults(accuracy, speed) {
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML += `
        <p>Accuracy: ${accuracy.toFixed(2)}%</p>
        <p>Reading Speed: ${speed} words per minute</p>
        <hr>
      `;
    }

    function highlightWord() {
      const wordsArray = textToRead[currentTextIndex].split(' ');
      const highlightedText = wordsArray.map((word, index) => {
        if (index === wordIndex) {
          return `<span class="highlight">${word}</span>`;
        } else {
          return word;
        }
      }).join(' ');
      textToReadElement.innerHTML = highlightedText;
    }
  </script>
</body>
</html>
